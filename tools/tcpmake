#! /bin/bash

export PATH=~/tcp/tools:$PATH

cd ~/tcp/lib; make
cd ~/tcp/tools; make

for dir in \
        ~/tcp \
        ~/tcp/NeXT \
        ~/tcp/aos \
        ~/tcp/bbs \
        ~/tcp/convers \
        ~/tcp/doc \
        ~/tcp/examples \
        ~/tcp/lib \
        ~/tcp/src \
        ~/tcp/tools \
        ~/tcp/util \
        ; do
        cd $dir
        file=Makefile
        if [[ -f $file ]]; then
                make_depend
        fi
done

for manual in bbs bridge smack wampes; do
        cd ~/tcp/manuals/$manual
        cat $(< filelist) > ../../doc/$manual.mm
done

cd ~/tcp/doc
for manual in bbs bridge smack wampes; do
        mm2html.py $manual.mm > $manual.html
done

# cd ~/tcp/bbs
# file=bbs.help
# save_file $file
# groff -p -t -mgm -Tascii < ~/tcp/doc/bbs.mm | sed 's/.//g' | awk '
#         /BBS Reference Manual.*Version/ {
#                 next
#         }
#         /^ *CONTENTS *$/ {
#                 exit
#         }
#         /^[0-9][0-9]*\.[0-9]* \ / {
#                 print ""
#                 print "^" $2
#                 print ""
#                 sub("^[0-9][0-9]*\.[0-9]* \ ", "")
#                 print
#                 next
#         }
#         {
#                 print
#         }
# ' | trim -s > $file
# check_file $file

cd ~/tcp
make

cd ~/tcp/src
make tags TAGS

echo '***** tcpmake complete *****'
