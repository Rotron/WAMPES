# @(#) $Id: configure,v 1.27 1996-08-20 18:09:24 deyke Exp $

case "`uname -sr`" in
HP-UX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc='c89 -D_HPUX_SOURCE';;
AIX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-L; cc='cc -D_ALL_SOURCE';;
IRIX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-L; cc=cc;;
Linux*)
	isdir=-d; isexec=-x; isfile=-f; islink=-L; cc=gcc;;
386BSD*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=cc;;
FreeBSD*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=cc;;
BSD/386*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=cc;;
SunOS\ 4.*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=acc;;
SunOS\ 5.*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=cc;;
ULTRIX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc='gcc -DULTRIX_RISC';;
A/UX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc='gcc -D_POSIX_SOURCE';;
RISC\ iX*)
	isdir=-d; isexec=-x; isfile=-f; islink=-h; cc=/tcp/cc;;
AOS*)
	isdir=-d; isexec=-x; isfile=-f; islink=-L; cc=/usr/local/bin/gcc;;
*)
	echo System `uname -sr` is not supported >&2
	exit 1;;
esac

tmp=tmp$$

findfile()
{
	name=$1
	shift
	for i in $*; do
		if [ $isfile $i -a ! $islink $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	echo "#define ${name} \"\""
}

findprog()
{
	name=$1
	shift
	for i in $*; do
		if [ $isfile $i -a $isexec $i -a ! $islink $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	for i in $*; do
		if [ $isfile $i -a $isexec $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	for i in $*; do
		if [ $isfile $i -a ! $islink $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	for i in $*; do
		if [ $isfile $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	echo "#define ${name} \"\""
}

finddir()
{
	name=$1
	shift
	for i in $*; do
		if [ $isdir $i -a ! $islink $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	for i in $*; do
		if [ $isdir $i ]; then
			echo "#define ${name} \"$i\""
			return
		fi
	done
	echo "#define ${name} \"\""
}

checksymbol()
{
	echo "$2" >$tmp.c
	if $cc $tmp.c -o $tmp >/dev/null 2>&1; then
		echo "#define $1 1"
	else
		echo "#define $1 0"
	fi
}

echo "#ifndef _CONFIGURE_H"
echo "#define _CONFIGURE_H"
echo

finddir HOME_DIR \
	/home \
	/users \
	/usr/people \
	/u

finddir MAIL_DIR \
	/var/mail \
	/var/spool/mail \
	/usr/mail \
	/usr/spool/mail

finddir NEWS_DIR \
	/var/spool/news \
	/usr/spool/news

finddir SPOOL_DIR \
	/var/spool \
	/usr/spool

finddir UUCP_DIR \
	/var/spool/uucp \
	/usr/spool/uucp

echo

findfile ALIASES_FILE \
	/etc/aliases \
	/etc/mail/aliases \
	/usr/lib/aliases

findfile UTMP__FILE \
	/var/adm/utmp \
	/var/run/utmp \
	/etc/utmp

findfile WTMP__FILE \
	/var/adm/wtmp \
	/var/log/wtmp \
	/etc/wtmp \
	/usr/adm/wtmp

echo

findprog CTLINND_PROG \
	/usr/local/news/bin/ctlinnd \
	/usr/lib/news/bin/ctlinnd

findprog GZIP_PROG \
	/usr/bin/gzip \
	/bin/gzip \
	/usr/local/bin/gzip \
	/usr/contrib/bin/gzip

findprog LS_PROG \
	/usr/bin/ls \
	/bin/ls

findprog MAIL_PROG \
	/usr/openwin/bin/xview/mail \
	/usr/bin/mailx \
	/bin/mailx \
	/usr/sbin/Mail \
	/usr/bin/mail \
	/bin/mail

findprog NEWALIASES_PROG \
	/usr/bin/newaliases \
	/usr/sbin/newaliases \
	/usr/ucb/newaliases \
	/usr/bsd/newaliases

findprog RNEWS_PROG \
	/usr/bin/rnews \
	/usr/local/bin/rnews \
	/usr/lib/news/rnews \
	/usr/lib/rnews

findprog SENDMAIL_PROG \
	/usr/sbin/sendmail \
	/usr/lib/sendmail

echo

checksymbol HAS_ADJTIME \
	"main(){adjtime(0,0);}"

checksymbol HAS_STRDUP \
	"main(){strdup(0);}"

checksymbol HAS_STRERROR \
	"main(){strerror(0);}"

checksymbol HAS_STRTOUL \
	"main(){strtoul(0,0,0);}"

checksymbol HAS_UINT \
	"#include <sys/types.h>
	 main(){uint f;return f;}"

echo
echo "#endif"

rm -f $tmp*
